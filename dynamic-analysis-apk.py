import os

import frida
import subprocess

from dotenv import load_dotenv

load_dotenv()

filename = os.getenv("MALWARE_DIRECTORY")

device_id = subprocess.check_output(['adb', 'devices']).split()[4].decode('utf-8')
device = frida.get_device(device_id)

subprocess.call(['adb', 'install', filename])
process = device.attach(filename)

jscode = """
Java.perform(function () {
  var Activity = Java.use("com.example.Activity");
  Activity.method.implementation = function () {
    console.log("method called");
    return this.method();
  }
});
"""

script = process.create_script(jscode)
script.load()
process.resume()

input("Press enter to exit...")

process.detach()
script.unload()
